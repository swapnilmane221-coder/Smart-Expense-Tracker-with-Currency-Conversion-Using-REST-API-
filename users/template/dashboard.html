{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard</title>
  <link rel="stylesheet" href="{% static 'css/dashboard.css' %}" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar">
    <div class="nav-left">
      <span class="logo">ðŸ’¼</span>
      <span class="brand">EXPENSE</span>
    </div>
    <div class="nav-right">
      <a href="{% url 'expense-history' %}">Expense History</a>
      
      <a href="#" class="active">Dashboard</a>
      <a href="{% url 'add-expense' %}">Add Expense</a>
      
      <a href="{% url 'profile-setting' %}"><div class="avatar">ðŸ‘¤</div></a>
    </div>
  </nav>

  <main class="dashboard">
    <section class="dashboard-header">
      <h1>Dashboard</h1>
    </section>

    <!-- Top Row: Cards + Currency -->
    <section class="top-row">
      <div class="cards">
        <div class="card">
          <h2>â‚¹{{total_amount}}</h2>
          <p>Total Expenses</p>
        </div>
        <div class="card">
          <h2>{{transaction_count}}</h2>
          <p>Transactions</p>
        </div>
        <div class="card">
          <h2>{{ high_cat.category }}</h2>
          <p>Highest Category</p>
        </div>
      </div>

      <style>
.currency-box {
  background: #f9fafb;
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  max-width: 400px;
  margin: auto;
  font-family: Arial, sans-serif;
}

.currency-box h3 {
  margin-bottom: 15px;
  text-align: center;
  color: #2563eb;
}

.currency-controls {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.currency-row {
  display: flex;
  align-items: center;
  gap: 10px;
}

.currency-row label {
  font-size: 14px;
  min-width: 45px;
}

.currency-row select,
.currency-row input {
  flex: 1;
  padding: 6px 10px;
  border: 1px solid #ddd;
  border-radius: 6px;
  font-size: 14px;
}

.currency-row input {
  max-width: 120px;
}

.currency-result {
  flex: 1.5;
  font-size: 16px;
  font-weight: bold;
  text-align: right;
  color: #2563eb;
}
#currency-select,
#currency-select_convert {
  width: 100px;
}
</style>

<div class="currency-box">
  <h3>ðŸ’± Currency Converter</h3>
  
  <div class="currency-controls">
    <!-- From + Amount in one row -->
    <div class="currency-row">
      <label>From</label>
      <select id="currency-select">
        <option value="USD">$ USD â€“ US Dollar</option>
<option value="EUR">â‚¬ EUR â€“ Euro</option>
<option value="INR">â‚¹ INR â€“ Indian Rupee</option>
<option value="GBP">Â£ GBP â€“ British Pound</option>
<option value="JPY">Â¥ JPY â€“ Japanese Yen</option>
<option value="AUD">$ AUD â€“ Australian Dollar</option>
<option value="CAD">$ CAD â€“ Canadian Dollar</option>
<option value="CHF">CHF â€“ Swiss Franc</option>
<option value="CNY">Â¥ CNY â€“ Chinese Yuan</option>
<option value="BRL">R$ BRL â€“ Brazilian Real</option>
<option value="RUB">â‚½ RUB â€“ Russian Ruble</option>
<option value="ZAR">R ZAR â€“ South African Rand</option>
<option value="KRW">â‚© KRW â€“ South Korean Won</option>
<option value="SGD">$ SGD â€“ Singapore Dollar</option>
<option value="HKD">$ HKD â€“ Hong Kong Dollar</option>
<option value="MXN">$ MXN â€“ Mexican Peso</option>
<option value="NZD">$ NZD â€“ New Zealand Dollar</option>
<option value="SEK">kr SEK â€“ Swedish Krona</option>
<option value="NOK">kr NOK â€“ Norwegian Krone</option>
<option value="DKK">kr DKK â€“ Danish Krone</option>
<option value="PLN">zÅ‚ PLN â€“ Polish Zloty</option>
<option value="TRY">â‚º TRY â€“ Turkish Lira</option>
<option value="THB">à¸¿ THB â€“ Thai Baht</option>
<option value="IDR">Rp IDR â€“ Indonesian Rupiah</option>
<option value="MYR">RM MYR â€“ Malaysian Ringgit</option>
<option value="PHP">â‚± PHP â€“ Philippine Peso</option>
<option value="VND">â‚« VND â€“ Vietnamese Dong</option>
<option value="AED">Ø¯.Ø¥ AED â€“ UAE Dirham</option>
<option value="SAR">ï·¼ SAR â€“ Saudi Riyal</option>
<option value="EGP">Â£ EGP â€“ Egyptian Pound</option>
<option value="NGN">â‚¦ NGN â€“ Nigerian Naira</option>
<option value="PKR">â‚¨ PKR â€“ Pakistani Rupee</option>
<option value="BDT">à§³ BDT â€“ Bangladeshi Taka</option>
<option value="ILS">â‚ª ILS â€“ Israeli Shekel</option>

      </select>
      <input type="number" id="amount-input" value="1" min="1" />
    </div>
    
    <!-- To + Converted Result in one row -->
    <div class="currency-row">
      <label>To</label>
      <select id="currency-select_convert">
       <option value="USD">$ USD â€“ US Dollar</option>
<option value="EUR">â‚¬ EUR â€“ Euro</option>
<option value="INR">â‚¹ INR â€“ Indian Rupee</option>
<option value="GBP">Â£ GBP â€“ British Pound</option>
<option value="JPY">Â¥ JPY â€“ Japanese Yen</option>
<option value="AUD">$ AUD â€“ Australian Dollar</option>
<option value="CAD">$ CAD â€“ Canadian Dollar</option>
<option value="CHF">CHF â€“ Swiss Franc</option>
<option value="CNY">Â¥ CNY â€“ Chinese Yuan</option>
<option value="BRL">R$ BRL â€“ Brazilian Real</option>
<option value="RUB">â‚½ RUB â€“ Russian Ruble</option>
<option value="ZAR">R ZAR â€“ South African Rand</option>
<option value="KRW">â‚© KRW â€“ South Korean Won</option>
<option value="SGD">$ SGD â€“ Singapore Dollar</option>
<option value="HKD">$ HKD â€“ Hong Kong Dollar</option>
<option value="MXN">$ MXN â€“ Mexican Peso</option>
<option value="NZD">$ NZD â€“ New Zealand Dollar</option>
<option value="SEK">kr SEK â€“ Swedish Krona</option>
<option value="NOK">kr NOK â€“ Norwegian Krone</option>
<option value="DKK">kr DKK â€“ Danish Krone</option>
<option value="PLN">zÅ‚ PLN â€“ Polish Zloty</option>
<option value="TRY">â‚º TRY â€“ Turkish Lira</option>
<option value="THB">à¸¿ THB â€“ Thai Baht</option>
<option value="IDR">Rp IDR â€“ Indonesian Rupiah</option>
<option value="MYR">RM MYR â€“ Malaysian Ringgit</option>
<option value="PHP">â‚± PHP â€“ Philippine Peso</option>
<option value="VND">â‚« VND â€“ Vietnamese Dong</option>
<option value="AED">Ø¯.Ø¥ AED â€“ UAE Dirham</option>
<option value="SAR">ï·¼ SAR â€“ Saudi Riyal</option>
<option value="EGP">Â£ EGP â€“ Egyptian Pound</option>
<option value="NGN">â‚¦ NGN â€“ Nigerian Naira</option>
<option value="PKR">â‚¨ PKR â€“ Pakistani Rupee</option>
<option value="BDT">à§³ BDT â€“ Bangladeshi Taka</option>
<option value="ILS">â‚ª ILS â€“ Israeli Shekel</option>

      </select>
      <div class="currency-result" id="currency-result">--</div>
    </div>
  </div>
</div>


    </section>

    <!-- Charts -->
    <section class="charts">
      <div class="chart">
        <h3>Expenses by Category</h3>
        <canvas id="categoryChart"></canvas>
      </div>
      <div class="chart">
        <h3>Monthly Spending</h3>
        <canvas id="monthlyChart"></canvas>
      </div>
    </section>
  </main>


<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const categories = JSON.parse('{{ categories|escapejs }}');
  const amounts = JSON.parse('{{ amounts|escapejs }}');
  const months = JSON.parse('{{ months|escapejs }}');
  const monthlyAmounts = JSON.parse('{{ monthly_amounts|escapejs }}');

  // Doughnut Chart
  new Chart(document.getElementById("categoryChart"), {
    type: "doughnut",
    data: {
      labels: categories,
      datasets: [{
        data: amounts,
        backgroundColor: ["#2563eb", "#22c55e", "#facc15", "#ef4444"],
        borderWidth: 0
      }]
    },
    options: { responsive: true, plugins: { legend: { position: "bottom" } } }
  });

  // Bar Chart
  new Chart(document.getElementById("monthlyChart"), {
    type: "bar",
    data: {
      labels: months,
      datasets: [{
        label: "Spending",
        data: monthlyAmounts,
        backgroundColor: "#2563eb",
        borderRadius: 5
      }]
    },
    options: { responsive: true, scales: { y: { beginAtZero: true } } }
  });
</script>

<script>
async function fetchRate() {
  const currency = document.getElementById("currency-select").value;
  const currency_convert = document.getElementById("currency-select_convert").value;
  const amount = document.getElementById("amount-input").value;

  if (!amount || amount <= 0) {
    document.getElementById("currency-result").innerText = "Enter valid amount";
    return;
  }

  try {
    // Call Django API
    const response = await fetch(`/api/convert/?amount=${amount}&from=${currency}&to=${currency_convert}`);
    const data = await response.json();

    if (data.converted_amount) {
      document.getElementById("currency-result").innerText =
        ` ${data.converted_amount} ${currency_convert}`;
    } else {
      document.getElementById("currency-result").innerText = "Conversion error";
    }
  } catch (error) {
    document.getElementById("currency-result").innerText = "API error";
  }
}

// Event listeners
document.getElementById("currency-select").addEventListener("change", fetchRate);
document.getElementById("amount-input").addEventListener("input", fetchRate);

// Load initial conversion
fetchRate();
</script>
</body>
</html>
